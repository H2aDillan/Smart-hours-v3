<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Earnings Tracker</title>
    <style>
        :root { --accent: #32CD32; --bg: #050505; --panel: #111; --text-dim: #666; --blue: #007aff; --red: #ff3b30; --yellow: #FFD700; --card: #181818; }
        body { background-color: var(--bg); margin: 0; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, "Inter", sans-serif; color: white; overflow: hidden; }

        /* Header & Icons */
        .header { position: absolute; top: 0; width: 100%; height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; box-sizing: border-box; z-index: 100; }
        .menu-icon, .stats-icon { cursor: pointer; width: 30px; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 24px; height: 2px; background-color: white; margin: 3.5px 0; }
        .stats-bars { display: flex; align-items: flex-end; gap: 3px; height: 18px; }
        .s-bar { width: 4px; background: white; border-radius: 1px; }

        /* Rate Input */
        .rate-input-group { display: flex; flex-direction: column; align-items: center; }
        .rate-label { font-size: 0.5rem; letter-spacing: 2px; color: var(--text-dim); margin-bottom: 2px; font-weight: bold; }
        #hourlyRate { background: transparent; border: none; border-bottom: 1px solid #222; color: white; font-size: 1.1rem; text-align: center; width: 55px; outline: none; }

        /* Sidebar Menu */
        .side-menu { position: fixed; top: 0; left: 0; width: 75%; height: 100%; background: #0f0f0f; z-index: 210; transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); border-right: 1px solid #222; display: flex; flex-direction: column; }
        .side-menu.open { transform: translateX(0); }
        .menu-items { padding: 40px 25px; display: flex; flex-direction: column; gap: 35px; }
        .menu-link { color: #fff; text-decoration: none; font-size: 1.2rem; font-weight: 300; letter-spacing: 1px; }
        .blue-settings-btn { position: absolute; bottom: 25px; right: 20px; background: var(--blue); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: 800; cursor: pointer; }

        /* Professional Modals */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 300; align-items: center; justify-content: center; }
        .modal-card { background: var(--panel); padding: 30px; border-radius: 24px; width: 85%; border: 1px solid #333; box-shadow: 0 20px 40px rgba(0,0,0,0.5); text-align: center; }
        .modal-card input, .modal-card select, .modal-card textarea { width: 100%; padding: 15px; margin-bottom: 15px; background: #000; border: 1px solid #333; color: white; border-radius: 12px; outline: none; box-sizing: border-box; }
        .modal-footer { display: flex; gap: 12px; margin-top: 10px; }
        .btn-m { flex: 1; padding: 15px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; }

        /* Main UI (Keyboard Stable) */
        .main-stage { position: absolute; top: 250px; left: 50%; transform: translateX(-50%); text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .earnings-glow { font-size: 1.6rem; font-weight: 700; color: var(--accent); text-shadow: 0 0 20px rgba(50, 205, 50, 0.35); }
        .timer-text { font-size: 3.5rem; font-weight: 200; letter-spacing: -1px; font-variant-numeric: tabular-nums; }
        #breakTimerDisplay { font-size: 1.2rem; color: var(--red); font-weight: bold; height: 20px; margin-top: 5px; visibility: hidden; }
        #breakTimerDisplay.visible { visibility: visible; }

        .controls-row { display: flex; align-items: center; justify-content: center; position: relative; width: 300px; height: 55px; margin-top: 20px; }
        button.action { height: 48px; width: 130px; font-size: 0.8rem; font-weight: bold; border-radius: 12px; border: none; cursor: pointer; text-transform: uppercase; transition: 0.4s ease; position: absolute; }
        .btn-start-stop { background-color: var(--accent); color: #000; z-index: 2; left: 50%; transform: translateX(-50%); }
        .btn-start-stop.active { background-color: var(--red); color: #fff; transform: translateX(-105%); }
        .btn-break { background-color: var(--yellow); color: #000; opacity: 0; pointer-events: none; left: 50%; transform: translateX(-50%); z-index: 1; }
        .btn-break.active { opacity: 1; pointer-events: auto; transform: translateX(5%); }
        .btn-break.stop-break { background-color: var(--red); color: #fff; }

        /* Dashboard */
        .dashboard-panel { position: fixed; bottom: 0; left: 0; width: 100%; height: 70vh; background: rgba(10, 10, 10, 0.98); backdrop-filter: blur(25px); border-top: 1px solid rgba(255,255,255,0.1); z-index: 90; transform: translateY(calc(70vh - 65px)); transition: transform 0.6s ease; border-radius: 30px 30px 0 0; }
        .dashboard-panel.expanded { transform: translateY(0); }
        .dashboard-handle { height: 65px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; }
        .handle-label { font-size: 0.75rem; color: #fff; letter-spacing: 4px; font-weight: 700; text-transform: uppercase; }
        .plus-icon { position: absolute; right: 25px; width: 24px; height: 24px; border: 1.5px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

        /* Job Selector UI */
        .job-nav-box { padding: 15px 25px; border-bottom: 1px solid #1a1a1a; display: flex; flex-direction: column; align-items: center; }
        .job-select-wrapper { position: relative; width: 100%; max-width: 250px; background: #161616; border-radius: 12px; border: 1px solid #333; overflow: hidden; }
        #jobSelector { width: 100%; background: transparent; color: var(--accent); border: none; padding: 12px 35px 12px 15px; font-size: 0.85rem; font-weight: 700; outline: none; appearance: none; text-align: center; }
        .dropdown-arrow { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 5px solid var(--accent); }

        .dashboard-content { padding: 10px 20px; height: calc(100% - 150px); overflow-y: auto; }
        .history-card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 12px; border: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .tag-name { font-size: 1.1rem; font-weight: 800; color: #fff; text-transform: uppercase; }
        .meta-text { font-size: 0.65rem; color: var(--text-dim); }
        .amount-text { color: var(--accent); font-size: 1.4rem; font-weight: 900; }
    </style>
</head>
<body>

    <header class="header">
        <div id="menuBtn" class="menu-icon"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        <div class="rate-input-group">
            <div class="rate-label">HOURLY RATE</div>
            <div class="rate-box"><span id="rateCurrency" style="color:#444">$</span><input type="number" id="hourlyRate" value="50"></div>
        </div>
        <div class="stats-icon"><div class="stats-bars"><div class="s-bar" style="height:10px;"></div><div class="s-bar" style="height:18px;"></div><div class="s-bar" style="height:14px;"></div></div></div>
    </header>

    <div id="sideMenu" class="side-menu">
        <div style="padding: 25px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center;">
            <span style="font-weight:bold; letter-spacing:2px">MENU</span>
            <span id="closeMenu" style="color:var(--red); font-size:0.8rem; font-weight:bold; cursor:pointer">CLOSE</span>
        </div>
        <div class="menu-items">
            <a href="#" class="menu-link">Goals</a>
            <a href="#" class="menu-link">Predictions</a>
            <a href="#" class="menu-link">Calendar</a>
        </div>
        <button id="openSettings" class="blue-settings-btn">SETTINGS</button>
    </div>

    <div id="settingsPanel" class="modal-overlay">
        <div class="modal-card">
            <h3>Global Settings</h3>
            <label style="font-size: 0.7rem; color: #888; display: block; margin-bottom: 5px;">CURRENCY SYMBOL</label>
            <select id="currencySelector">
                <option value="$">USD ($)</option><option value="€">EUR (€)</option><option value="£">GBP (£)</option><option value="R">ZAR (R)</option>
            </select>
            <button onclick="closeModal('settingsPanel')" class="btn-m" style="background:var(--accent); width:100%">DONE</button>
        </div>
    </div>

    <div id="jobModal" class="modal-overlay">
        <div class="modal-card">
            <h3>New Job Session</h3>
            <input type="text" id="jobInput" placeholder="Paystub Name (e.g. Project Alpha)">
            <div class="modal-footer">
                <button onclick="closeModal('jobModal')" class="btn-m" style="background:#222; color:#888">CANCEL</button>
                <button id="confirmJob" class="btn-m" style="background:var(--accent)">CREATE</button>
            </div>
        </div>
    </div>

    <div id="saveModal" class="modal-overlay">
        <div class="modal-card">
            <h3>Session Log</h3>
            <input type="text" id="sessionTag" placeholder="Tag Name">
            <textarea id="sessionNote" placeholder="Notes (Optional)" rows="2"></textarea>
            <div class="modal-footer">
                <button id="cancelSave" class="btn-m" style="background:#222; color:#888">DISCARD</button>
                <button id="confirmSave" class="btn-m" style="background:var(--accent)">SAVE</button>
            </div>
        </div>
    </div>

    <main class="main-stage">
        <div id="earnings" class="earnings-glow">$0.00</div>
        <div id="timer" class="timer-text">00:00:00:00</div>
        <div id="breakTimerDisplay">00:00:00:00</div>
        <div class="controls-row">
            <button id="breakBtn" class="btn-break action">BREAK</button>
            <button id="actionBtn" class="btn-start-stop action">START</button>
        </div>
    </main>

    <div id="dashboard" class="dashboard-panel">
        <div class="dashboard-handle"><span class="handle-label">Dashboard</span><div id="addJobBtn" class="plus-icon">+</div></div>
        <div class="job-nav-box"><div class="job-select-wrapper"><select id="jobSelector"></select><div class="dropdown-arrow"></div></div></div>
        <div id="historyList" class="dashboard-content"></div>
    </div>

    <script>
        const actionBtn = document.getElementById('actionBtn'), breakBtn = document.getElementById('breakBtn'),
              timerDisplay = document.getElementById('timer'), earningsDisplay = document.getElementById('earnings'),
              breakTimerDisplay = document.getElementById('breakTimerDisplay'), historyList = document.getElementById('historyList'),
              jobSelector = document.getElementById('jobSelector'), rateInput = document.getElementById('hourlyRate'),
              currencySelector = document.getElementById('currencySelector'), rateCurrency = document.getElementById('rateCurrency');

        let startTime, timerInterval, isRunning = false, isPaused = false,
            pausedTime = 0, currentBreakSession = 0, totalPausedAccumulated = 0, breakStartTime,
            sessionStartClock, sessionEndClock, currentCurrency = "$";

        let sessionLogs = JSON.parse(localStorage.getItem('pro_tracker_v23')) || { "Default Session": [] };

        function init() {
            updateJobDropdown();
            renderHistory();
            rateInput.value = localStorage.getItem('rate') || 50;
            currentCurrency = localStorage.getItem('currency') || "$";
            currencySelector.value = currentCurrency;
            rateCurrency.textContent = currentCurrency;
        }

        function saveData() { localStorage.setItem('pro_tracker_v23', JSON.stringify(sessionLogs)); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // Job logic
        document.getElementById('addJobBtn').onclick = (e) => { e.stopPropagation(); document.getElementById('jobModal').style.display = 'flex'; };
        document.getElementById('confirmJob').onclick = () => {
            const name = document.getElementById('jobInput').value.trim() || "New Job";
            if(!sessionLogs[name]) { sessionLogs[name] = []; updateJobDropdown(); jobSelector.value = name; saveData(); renderHistory(); }
            closeModal('jobModal');
        };
        function updateJobDropdown() { jobSelector.innerHTML = ""; Object.keys(sessionLogs).forEach(k => { const opt = document.createElement('option'); opt.value = k; opt.textContent = k.toUpperCase(); jobSelector.appendChild(opt); }); }
        jobSelector.onchange = renderHistory;

        // UI Toggles
        document.getElementById('menuBtn').onclick = () => document.getElementById('sideMenu').classList.add('open');
        document.getElementById('closeMenu').onclick = () => document.getElementById('sideMenu').classList.remove('open');
        document.getElementById('openSettings').onclick = () => document.getElementById('settingsPanel').style.display = 'flex';
        currencySelector.onchange = (e) => { currentCurrency = e.target.value; rateCurrency.textContent = currentCurrency; localStorage.setItem('currency', currentCurrency); updateUI(); };
        rateInput.oninput = () => localStorage.setItem('rate', rateInput.value);

        // Timer Logic
        actionBtn.onclick = () => {
            if (!isRunning) {
                isRunning = true; startTime = Date.now(); totalPausedAccumulated = 0; currentBreakSession = 0;
                sessionStartClock = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                actionBtn.textContent = 'STOP'; actionBtn.classList.add('active'); breakBtn.classList.add('active');
                timerInterval = setInterval(updateUI, 10);
            } else {
                isRunning = false; clearInterval(timerInterval);
                sessionEndClock = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                document.getElementById('saveModal').style.display = 'flex';
            }
        };

        breakBtn.onclick = () => {
            if (!isPaused) {
                isPaused = true; breakStartTime = Date.now();
                breakBtn.textContent = 'STOP BREAK'; breakBtn.classList.add('stop-break');
                breakTimerDisplay.classList.add('visible');
            } else {
                isPaused = false;
                currentBreakSession += (Date.now() - breakStartTime);
                totalPausedAccumulated = currentBreakSession;
                breakBtn.textContent = 'BREAK'; breakBtn.classList.remove('stop-break');
                // Persist the display: we don't remove .visible here
            }
        };

        document.getElementById('confirmSave').onclick = () => {
            const log = {
                tag: document.getElementById('sessionTag').value || "NO TAG",
                note: document.getElementById('sessionNote').value,
                start: sessionStartClock, end: sessionEndClock,
                date: new Date().toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'}),
                earnings: earningsDisplay.textContent, duration: timerDisplay.textContent,
                breakVal: totalPausedAccumulated > 0 ? formatTime(totalPausedAccumulated) : null
            };
            sessionLogs[jobSelector.value].push(log);
            saveData(); renderHistory(); closeModal('saveModal'); resetUI();
        };

        document.getElementById('cancelSave').onclick = () => { closeModal('saveModal'); resetUI(); };

        function resetUI() {
            actionBtn.textContent = 'START'; actionBtn.classList.remove('active'); breakBtn.classList.remove('active');
            timerDisplay.textContent = "00:00:00:00"; earningsDisplay.textContent = currentCurrency + "0.00";
            breakTimerDisplay.classList.remove('visible'); breakTimerDisplay.textContent = "00:00:00:00";
            document.getElementById('sessionTag').value = ""; document.getElementById('sessionNote').value = "";
        }

        function updateUI() {
            const now = Date.now();
            if (!isPaused) {
                const elapsed = now - startTime - totalPausedAccumulated;
                const earnings = (parseFloat(rateInput.value) || 0) / 3600000 * elapsed;
                timerDisplay.textContent = formatTime(elapsed);
                earningsDisplay.textContent = currentCurrency + earnings.toFixed(2);
            } else {
                const currentBreak = now - breakStartTime;
                breakTimerDisplay.textContent = formatTime(currentBreakSession + currentBreak);
            }
        }

        function formatTime(ms) { const s = Math.floor(ms / 1000); return [Math.floor(s/3600), Math.floor((s%3600)/60), s%60, Math.floor((ms%1000)/10)].map(v => v.toString().padStart(2,'0')).join(':'); }
        function renderHistory() {
            historyList.innerHTML = "";
            const logs = sessionLogs[jobSelector.value] || [];
            logs.slice().reverse().forEach(l => {
                const card = document.createElement('div'); card.className = 'history-card';
                card.innerHTML = `<div><div class="tag-name">${l.tag}</div><div class="meta-text">${l.start} — ${l.end} | ${l.date}</div>${l.breakVal ? `<div style="color:var(--red); font-size:0.7rem; font-weight:bold; margin-top:5px">BREAK: ${l.breakVal}</div>` : ''}${l.note ? `<div style="font-size:0.85rem; color:#888; margin-top:5px; font-style:italic">${l.note}</div>` : ''}</div><div style="text-align:right"><div class="amount-text">${l.earnings}</div><div class="meta-text">${l.duration}</div></div>`;
                historyList.appendChild(card);
            });
        }

        document.getElementById('dashboard').onclick = (e) => { if(e.target.closest('.dashboard-handle') && !e.target.closest('#addJobBtn')) dashboard.classList.toggle('expanded'); };
        init();
    </script>
</body>
</html>
